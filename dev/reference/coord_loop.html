<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Looped coordinates — coord_loop • ggtime</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Looped coordinates — coord_loop"><meta property="og:description" content="The looped coordinate system loops the cartesian coordinate system around
specific loop points. This is particularly useful for visualising seasonal
patterns that repeat over calendar periods, since the shape of seasonal
patterns can be more easily seen when superimposed on top of each other."><meta property="og:image" content="https://pkg.mitchelloharawild.com/ggtime/logo.svg"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Privacy-friendly analytics by Plausible --><script async src="https://track.mitchelloharawild.com/js/pa-hMJNm4vrMJmtfgDWedFn0.js"></script><script>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggtime</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ggtime.html">Introduction to ggtime</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mitchelloharawild/ggtime" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Looped coordinates</h1>
    <small class="dont-index">Source: <a href="https://github.com/mitchelloharawild/ggtime/blob/main/R/coord-loop.R" class="external-link"><code>R/coord-loop.R</code></a></small>
    <div class="hidden name"><code>coord_loop.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The looped coordinate system loops the cartesian coordinate system around
specific loop points. This is particularly useful for visualising seasonal
patterns that repeat over calendar periods, since the shape of seasonal
patterns can be more easily seen when superimposed on top of each other.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">coord_loop</span><span class="op">(</span></span>
<span>  loops <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/waiver.html" class="external-link">waiver</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  time_loops <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/waiver.html" class="external-link">waiver</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  ljust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  xlim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ylim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  expand <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  default <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  clip <span class="op">=</span> <span class="st">"on"</span>,</span>
<span>  clip_loops <span class="op">=</span> <span class="st">"on"</span>,</span>
<span>  coord <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-loops">loops<a class="anchor" aria-label="anchor" href="#arg-loops"></a></dt>
<dd><p>Loop the time scale around a calendrical granularity, one of:</p><ul><li><p><code>NULL</code> or <code><a href="https://ggplot2.tidyverse.org/reference/waiver.html" class="external-link">waiver()</a></code> for no looping (the default)</p></li>
<li><p>A <code>mixtime</code> vector giving time points at which the <code>time</code> axis should loop</p></li>
<li><p>A function that takes the limits as input and returns loop points as output</p></li>
</ul></dd>


<dt id="arg-time-loops">time_loops<a class="anchor" aria-label="anchor" href="#arg-time-loops"></a></dt>
<dd><p>A duration giving the distance between temporal
loops like "2 weeks", or "10 years". If both <code>loops</code> and <code>time_loops</code> are
specified, <code>time_loops</code> wins.</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>A string specifying which aesthetic contains the time variable that
should be looped over. Default is <code>"x"</code>.</p></dd>


<dt id="arg-ljust">ljust<a class="anchor" aria-label="anchor" href="#arg-ljust"></a></dt>
<dd><p>Loop justification, a number between 0 and 1
indicating where the lines between looped positions are drawn
(0 indicates left, 1 indicates right, 0.5 indicates center).</p></dd>


<dt id="arg-xlim-ylim">xlim, ylim<a class="anchor" aria-label="anchor" href="#arg-xlim-ylim"></a></dt>
<dd><p>Limits for the x and y axes. <code>NULL</code> means use the default limits.</p></dd>


<dt id="arg-expand">expand<a class="anchor" aria-label="anchor" href="#arg-expand"></a></dt>
<dd><p>Logical indicating whether to expand the coordinate limits.
Default is <code>FALSE</code>.</p></dd>


<dt id="arg-default">default<a class="anchor" aria-label="anchor" href="#arg-default"></a></dt>
<dd><p>Logical indicating whether this is the default coordinate system.
Default is <code>FALSE</code>.</p></dd>


<dt id="arg-clip">clip<a class="anchor" aria-label="anchor" href="#arg-clip"></a></dt>
<dd><p>Should drawing be clipped to the extent of the plot panel?
A setting of <code>"on"</code> (the default) means yes, and a setting of <code>"off"</code> means no.</p></dd>


<dt id="arg-clip-loops">clip_loops<a class="anchor" aria-label="anchor" href="#arg-clip-loops"></a></dt>
<dd><p>Should the drawing of each loop of the timescale be clipped to
the breaks defined by <code>time_loops</code> and <code>ljust</code>?
A setting of <code>"on"</code> (the default) means yes, and a setting of <code>"off"</code> means no.</p></dd>


<dt id="arg-coord">coord<a class="anchor" aria-label="anchor" href="#arg-coord"></a></dt>
<dd><p>The underlying coordinate system to use. Default is <code><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian()</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>Coord</code> ggproto object that can be added to a ggplot.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This coordinate system is particularly useful for visualizing seasonal or
cyclic patterns in time series data. It works by:</p>
<ol><li><p>Dividing the time axis into segments based on the specified loop period</p></li>
<li><p>Translating each segment to overlay on the first segment</p></li>
<li><p>Creating a visualization where multiple time periods are superimposed</p></li>
</ol><p>The coordinate system requires R version 4.2.0 or higher due to its use of
usage of clipping paths.</p>
    </div>
    <div id="practical-usage">
    <h2>Practical usage</h2>



<p>The looped coordinate system reveals patterns that repeat over regular time
periods, such as annual seasonality in monthly data, or weekly patterns in
daily data. It allows the <code>[x/y]</code> time aesthetic to be specified
continuously, and loops the time axis around specified time intervals. This
allows time within seasonal periods to be compared directly, and highlights
the shape of seasonal patterns. This is commonly used in time series analysis
to identify the peaks and troughs of seasonal patterns.</p>
<p>A key advantage of time being specified continuously is that the connection
between the end of one seasonal period and the start of the next is
preserved. This is otherwise lost when time is discretised into ordered
factors (e.g. months of the year, or days of week). This allows lines and
other geometries to be drawn across seasonal boundaries, such as a line that
connects December to January when plotting annual seasonality.
The justification parameter <code>ljust</code> controls the side of the panel where
these connections are made, left justificiation (<code>ljust = 0</code>) gives space
for inter-seasonal time on the left of the panel, right justification
(<code>ljust = 1</code>) uses the right side of the panel, and center justification
(<code>ljust = 0.5</code>, the default) uses equal spacing on both ends of the season.</p>
    </div>
    <div id="why-not-use-seasonal-factors-">
    <h2>Why not use seasonal factors?</h2>



<p>Using factors to represent seasonal periods is common, but prone to errors
and is very limiting. Suppose you want to visualize weekly seasonality in
daily data. You could convert the date into a day of week factor (e.g. with
<code>lubridate::wday(date, label = TRUE)</code>), but this loses information about the
year and week of the observation. In order to correctly draw lines connecting
each day of the week (avoiding sawtooth patterns), you would additionally
need to group by year and week to separately identify each line segment. The
aesthetic mapping for plotting this pattern would look something like:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">aes</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">x =</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">interaction</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date), lubridate<span class="sc">::</span><span class="fu">week</span>(date)),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">y =</span> value</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>These operations are error-prone, cumbersome, and are complicated to update
to show different seasonal patterns. For example, if you wanted to instead
show the annual seasonal pattern, both the <code>x</code> and <code>group</code> aesthetics would
need to be changed (to day of year and year respectively). Any errors in this
process would produce sawtooth patterns or other artifacts in the plot.</p>
<p>Another common error in discretizing time into seasonal factors is
incorrect ordering of the factor levels. For example, if you instead used
<code>strftime(date, "%a")</code> to get the day of week, the levels would be sorted
alphabetically rather than in time order ("Fri", "Mon", "Sat", ...). No-one
wants to Monday to follow Friday!</p>
<p>Discretizing time into seasonal factors also prevents plotting the seasonal
pattern across multiple granularities. For example when visualizing weekly
seasonality across data at daily and hourly frequencies, both day of week
and hour of week are needed. Since these factors have different levels, they
cannot be plotted on the same axis. In contrast, it is possible to plot both
daily and hourly data on the same axis using <code><a href="scale_mixtime.html">scale_x_mixtime()</a></code>, which can
then be looped over weekly periods with <code>coord_loop(time_loops = "1 week")</code>.</p>
<p>Another subtle issue of using factors instead of continuous time is that
spacing between time points is regularized. For example, when plotting the
annual seasonal pattern with months as a factor, each month is given equal
width on the x-axis despite the fact that months have different lengths.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/ggtime/">ggtime</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with US accidental deaths data</span></span></span>
<span class="r-in"><span><span class="va">uad</span> <span class="op">&lt;-</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">USAccDeaths</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Requires mixtime, POSIXct, or Date time types</span></span></span>
<span class="r-in"><span><span class="va">uad</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">uad</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">uad</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Original plot</span></span></span>
<span class="r-in"><span><span class="va">p</span></span></span>
<span class="r-plt img"><img src="coord_loop-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With yearly looping to show seasonal patterns</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">coord_loop</span><span class="op">(</span>time_loop <span class="op">=</span> <span class="st">"1 year"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="coord_loop-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://mitchelloharawild.com" class="external-link">Mitchell O’Hara-Wild</a>, <a href="https://www.cynthiahqy.com" class="external-link">Cynthia A. Huang</a>, <a href="https://www.mjskay.com" class="external-link">Matthew Kay</a>, <a href="http://robjhyndman.com" class="external-link">Rob Hyndman</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

